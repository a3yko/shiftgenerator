<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>Random Schedule Generator</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;max-width:1100px;margin:24px auto;padding:0 18px;color:#111}
h1{margin-bottom:6px}
label{display:block;margin:8px 0 4px;font-weight:600}
textarea,input,button{font-size:14px;padding:8px;border:1px solid #ccc;border-radius:6px}
.days{margin:4px 0 6px}
.person{border:1px solid #ddd;border-radius:6px;padding:8px;margin-top:6px}
button.small{font-size:13px;padding:6px 10px;margin-right:6px}
table{border-collapse:collapse;width:100%;margin-top:14px}
th,td{border:1px solid #ddd;padding:6px;text-align:left}
</style>
</head>
<body>
<h1>Random Schedule Generator</h1>

<label>Names (comma or one per line)</label>
<textarea id="names" rows="4" placeholder="Alice, Bob, Charlie"></textarea>

<div>
  <button id="makePeople" class="small">Create People Entries</button>
</div>

<div id="peopleArea"></div>

<label style="margin-top:12px">Start Date</label>
<input type="date" id="start">

<label>Days to Generate (e.g. 7 or 30)</label>
<input type="number" id="numDays" value="7" min="1">

<label>Slots per Day</label>
<input type="number" id="slots" value="1" min="1">

<div style="margin-top:8px">
  <button id="generate" class="small">Generate Schedule</button>
  <button id="csv" class="small">Export CSV</button>
</div>

<div id="output"></div>

<script>
const weekdays = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];

// Build person list
document.getElementById('makePeople').onclick = () => {
  const raw = document.getElementById('names').value.trim();
  if(!raw){alert('Enter some names first');return;}
  const names = raw.split(/,|\n/).map(x=>x.trim()).filter(Boolean);
  const area = document.getElementById('peopleArea');
  area.innerHTML = '';
  names.forEach((name,i)=>{
    const div=document.createElement('div');
    div.className='person';
    div.innerHTML=`<strong>${name}</strong>`;
    const daysDiv=document.createElement('div');
    daysDiv.className='days';
    weekdays.forEach((d,idx)=>{
      const lbl=document.createElement('label');
      lbl.style.marginRight='8px';
      const cb=document.createElement('input');
      cb.type='checkbox';cb.dataset.day=idx;
      lbl.appendChild(cb);
      lbl.appendChild(document.createTextNode(' '+d));
      daysDiv.appendChild(lbl);
    });
    div.appendChild(daysDiv);
    area.appendChild(div);
  });
};

// Helper random
function rand(arr){return arr[Math.floor(Math.random()*arr.length)];}

document.getElementById('generate').onclick = () => {
  const start = new Date(document.getElementById('start').value);
  const days = +document.getElementById('numDays').value;
  const slots = +document.getElementById('slots').value;
  if(isNaN(start)){alert('Pick a start date');return;}
  const peopleEls = document.querySelectorAll('.person');
  if(!peopleEls.length){alert('Add people first');return;}

  // Read people + days off
  const people = Array.from(peopleEls).map(div=>{
    const name=div.querySelector('strong').textContent;
    const off=[...div.querySelectorAll('input:checked')].map(cb=>+cb.dataset.day);
    return {name,off};
  });

  const counts={};people.forEach(p=>counts[p.name]=0);
  const schedule=[];
  for(let i=0;i<days;i++){
    const date=new Date(start);date.setDate(start.getDate()+i);
    const weekday=(date.getDay()+6)%7; // Mon=0
    const available=people.filter(p=>!p.off.includes(weekday));
    const names=[];
    const pool=[...available];
    while(names.length<slots && pool.length){
      // pick among least used
      const min=Math.min(...pool.map(p=>counts[p.name]));
      const candidates=pool.filter(p=>counts[p.name]===min);
      const choice=rand(candidates);
      names.push(choice.name);
      counts[choice.name]++;
      pool.splice(pool.indexOf(choice),1);
    }
    schedule.push({date,weekday,names});
  }

  // Render
  const out=document.getElementById('output');
  out.innerHTML='<h3>Schedule</h3>';
  const tbl=document.createElement('table');
  tbl.innerHTML='<tr><th>Date</th><th>Day</th><th>Assignments</th></tr>';
  schedule.forEach(r=>{
    const tr=document.createElement('tr');
    const dayStr=weekdays[r.weekday];
    tr.innerHTML=`<td>${r.date.toISOString().slice(0,10)}</td><td>${dayStr}</td><td>${r.names.join(', ')||'(none available)'}</td>`;
    tbl.appendChild(tr);
  });
  out.appendChild(tbl);
};

document.getElementById('csv').onclick = ()=>{
  const rows=[['Date','Day','Assignments']];
  document.querySelectorAll('#output table tr:not(:first-child)').forEach(tr=>{
    const tds=tr.querySelectorAll('td');
    rows.push([tds[0].textContent,tds[1].textContent,tds[2].textContent]);
  });
  if(rows.length===1){alert('No schedule yet');return;}
  const csv=rows.map(r=>r.map(x=>`"${x.replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='schedule.csv';a.click();
  URL.revokeObjectURL(url);
};
</script>
</body>
</html>
